{% extends "rh_base.html" %}
{% block titulo%} Proveedores {% endblock %}
{% block css %}
<style type="text/css">
#opcionesAgregar, #panelBuscar, #panelAgregar, #panelEditar {
  display: none;
}
th{
  text-align: center;
}
</style>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/jquery-ui-1.10.3.custom.css">
{% endblock %}
{% block js %}
<script type="text/javascript">
$(document).ready(function  () {
    paginacion();
});
</script>
{% endblock %}
{% block contenido %}
<h1>Proveedores</h1>
{% if mensaje %}
{% if tipoMensaje = 1 %}
<div class="alert alert-success alert-success">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
{% else %}
<div class="alert alert-danger alert-danger">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
{% endif %}
  <strong>{{mensaje}}</strong>
</div>
{% endif %}
<div id="mensaje" class="btn-group">
  <label id="agregar" class="btn btn-success btn-sm">
    <i class="fa fa-plus"></i> Nuevo Proveedor
  </label>
</div>
<div id="opcionesAgregar" class="btn-group">
  <label  id="cancelar" href="" class="btn btn-success btn-sm">
    <i class="fa fa-times"></i> Cancelar
  </label>
</div>
<div id="panelAgregar">
  <br />
  <form action="{% url 'agregarProveedor' %}" method="post" >
    {% csrf_token %}
    <div class="row">
      <div class="form-group col-lg-6">
        <label for="nombre">Codigo</label>
        <input  type="text" class="form-control" name="codigo"  required="" placeholder="Codigo">
      </div>
      <div class="form-group col-lg-6">
        <label for="documento">Nombre</label>
        <input type="text" class="form-control" name="nombre" required="" placeholder="Nombre">
      </div>
    </div>
    <div class="row">
      <div class="form-group col-lg-6">
        <label for="nombre">Direccion</label>
        <input type="text" class="form-control" name="direccion" required="" id="direccion" placeholder="Direccion">
      </div>
      <div class="form-group col-lg-6">
        <label for="documento">Telefono</label>
        <input type="number" class="form-control" name="telefono" required="" placeholder="Telefono">
      </div>
    </div>
    <div class="row">
      <div class="form-group col-lg-6">
        <input type="submit" class="btn-success btn-sm" value="Guardar Proveedor" />
      </div>
    </div>
  </form>
</div>

<table id="listaProveedores" class="table table-striped">
    <tr>
      <th style="width: 100px">Codigo
        <input type="text" class="input-sm" style="width: 100%" placeholder="Buscar" id= "busquedaCodigo" name="busquedaCodigo" onkeyup="paginacion()"/>
      </th>
      <th>Nombre
        <input type="text" class="input-sm" style="width: 100%" placeholder="Buscar" id= "busquedaNombre" name="busquedaNombre" onkeyup="paginacion()"/>
      </th>
      <th>Direccion
        <input type="text" class="input-sm" style="width: 100%" placeholder="Buscar" id= "busquedaDireccion" name="busquedaDireccion" onkeyup="paginacion()"/>
      </th>
      <th>Telefono
        <input type="text" class="input-sm" style="width: 100%" placeholder="Buscar" id= "busquedaTelefono" name="busquedaTelefono" onkeyup="paginacion()"/>
      </th>
    </tr>
    <tbody class="tabla" id="tabla" value="{{cont}}">
      {% for proveedor in listaProveedores %}
        <tr class="datoLista " style"cursor: pointer;" >
          <td id=""></td>
          <td id=""></td>
          <td id=""></td>
          <td id=""></td>
        </tr>
      {% endfor %}
    </tbody>
</table>
<center>
  <ul class="pagination" value="{{pag}}" id="paginacion">
    <li class="paginacionLi" value="-1"><a style="cursor: pointer;">&laquo;</a></li>
    <li class="paginacionLi" value="-2"><a style="cursor: pointer;">&raquo;</a></li>
  </ul>
</center>
<script type="text/javascript">
$("#agregar").click(function() {
  $("#opcionesLista").css("display","none");
  $("#opcionesAgregar").css("display","inline-block");
  $("#listaProveedores").css("display","none");
  $("#paginacion").css("display","none");
  $("#panelAgregar").css("display","block");
});

$("#cancelar").click(function() {
  $("#opcionesLista").css("display","inline-block");
  $("#opcionesAgregar").css("display","none");
  $("#listaProveedores").css("display","table");
  $("#paginacion").css("display","");
  $("#panelAgregar").css("display","none");
});
$('.paginacionLi').click(paginacion);
function paginacion(){
  var pag;
  try{
    pag = $(this).val(); 
  }catch(error){
    pag = 0;
  }
  var aux = $('.pagination').val();
  if  (aux == ""){
    aux = 1;
  }else
    aux = parseInt(aux);
  if(pag == '-1'){
    pag = aux-1;
    if(pag == 0)
      pag = 1;
  }else{
    if(pag == '-2'){
      pag = (aux+1);
      if(pag > {{cont}})
        pag = {{cont}};
    }else{
      pag = aux;
    }
  }
  busquedaCodigo = document.getElementById('busquedaCodigo').value;
  busquedaNombre = document.getElementById('busquedaNombre').value;
  busquedaDireccion = document.getElementById('busquedaDireccion').value;
  busquedaTelefono = document.getElementById('busquedaTelefono').value;
  if((busquedaCodigo.length > 0) || (busquedaNombre.length > 0) || (busquedaDireccion.length > 0) || (busquedaTelefono.length > 0)){
    var data = {'pag':pag, 'busquedaCodigo':busquedaCodigo,'busquedaNombre':busquedaNombre,'busquedaDireccion':busquedaDireccion,'busquedaTelefono':busquedaTelefono};
    var url = "{% url 'buscarProveedor' %}";
    var type = 'get';
    llamarAjax(data, url, type);
  } else {
    $('.pagination').val(pag);
    var data = {'pag':pag};
    var url = "{% url 'indexProveedor' %}";
    var type = 'get';
    llamarAjax(data, url, type);
  }
}

function llamarAjax(info, url, type){
  $.ajax({
    data: info,
    url: url,
    type: type,
    success: function (data){
      if (data.length > 0){
        llenarTabla(data);
      } else {
        $("#tabla").find('tr').each(function(index){
          $(this).removeClass("activo");
          $(this).removeClass("danger");
          if(index > data.length){
            $(this).attr("id","");
            $(this).find('td').each(function(index2){
              switch(index2){
                case 0:
                  $(this).attr("id","");
                  $(this).text("");
                  break;
                case 1:
                  $(this).attr("id","");
                  $(this).text("");
                  break;
                case 2:
                  $(this).attr("id","");
                  $(this).text("");
                  break;
                case 3:
                  $(this).attr("id","");
                  $(this).text("");
                  break;
              }
            });
          } else {
            $(this).addClass("danger");
            $(this).find('td').each(function(index2){
              if (index2 == 1){
                $(this).attr("id","");
                $(this).text("No hay Resultados");
              } else {
                $(this).attr("id","");
                $(this).text("");
              }
            });
          }
        });
      }
    }
  });
}

function llenarTabla (data) {
  if(data.mensaje == null){
    $("#listaProveedores").css("display","table");
    //$("#mensaje").css("display","none");
    $("#tabla").find('tr').each(function(index){
      $(this).removeClass("activo");
      $(this).removeClass("danger");
      if(index < data.length){
        $(this).addClass("activo");
        if(!data[index].fields.estado)
          $(this).addClass("danger");
        $(this).attr("id",data[index].pk);
        $(this).find('td').each(function(index2){
          switch(index2){
            case 0:
              $(this).attr("id",data[index].pk);
              $(this).text(data[index].pk);
              break;
            case 1:
              $(this).attr("id",data[index].fields.nombre);
              $(this).text(data[index].fields.nombre);
              break;
            case 2:
              $(this).attr("id",data[index].fields.direccion);
              $(this).text(data[index].fields.direccion);
              break;
            case 3:
              $(this).attr("id",data[index].fields.telefono);
              $(this).text(data[index].fields.telefono);
              break;
          }
        });
      } else {
        $(this).removeClass("danger");
        $(this).find('td').each(function(index2){
          $(this).attr("id","");
          $(this).text("");
        });
      }
    });
  }else{
    $("#listaProveedores").css("display","none");
    $("#mensaje").css("display","inline-block");
    $("#mensaje").html("<h1><p>"+data.mensaje+"</p></h1>");
  }
}

function editarProveedor (argument) {
  // body...
}
</script>
{% endblock %}